!function(e){e.fn.ddCascady=function(t){function n(e,t){var n=document.createElement("option");return n.text=e,n.value=t,n}var r=e.extend({service:null,method:"POST",firstElementOrderNumber:0},t);if("string"!=typeof r.service||""===r.service)throw Error("Ajax service has to be provided");var o={elements:[],findAllAfter:function(e){return this.elements.filter(function(t){return t>e})},findFirstAfter:function(e){var t=this.findAllAfter(e);return Math.min.apply(window,t)}};return this.each(function(){var t=e(this),a=t.data("order"),i=a===r.firstElementOrderNumber;if(i||t.empty(),o.hasOwnProperty(a))throw Error("You cannot have multiple drop down's with order "+a);o[a]={$element:t,element:this,json:t.data("json"),text:t.data("option-text"),value:t.data("option-value")},o.elements.push(a),t.change(function(){for(var t=o.findAllAfter(a),i=0;i<t.length;i++){var s=t[i];o[s].$element.empty()}for(var d={},i=0;i<o.elements.length;i++){var l=o.elements[i],f=o[l].element;f.selectedIndex>-1&&(d[f.name]=f.options[f.selectedIndex].value)}e.ajax(r.service,{data:d,dataType:"json",method:r.method}).done(function(e){var t=o.findFirstAfter(a),r=o[t];if(!e.hasOwnProperty(r.json))throw Error(r.json+" is not found in service response");var i=r.element,s=e[r.json],d=n("","");i.options.add(d);for(var l=0;l<s.length;l++){var f=n(s[l][r.text],s[l][r.value]);i.options.add(f)}})})})}}(jQuery);