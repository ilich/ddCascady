!function(e){"use strict";e.fn.ddCascady=function(t){function n(e,t){var n=document.createElement("option");return n.text=e,n.value=t,n}var r=e.extend({service:null,method:"POST",firstElementOrderNumber:0,loadAll:!1},t),o=r.loadAll,l=this;if(o&&this.prop("disabled",!0),"string"!=typeof r.service||""===r.service)throw Error("Ajax service has to be provided");var i={elements:[],findAllAfter:function(e){return this.elements.filter(function(t){return t>e})},findFirstAfter:function(e){var t=this.findAllAfter(e);return Math.min.apply(window,t)}},a=[],d=null;if(this.each(function(){var t=e(this),s=t.data("order"),f=s===r.firstElementOrderNumber;if(r.loadAll&&(a[s]=t.val()),f?(i.root=s,t.val("")):f||o||t.empty(),i.hasOwnProperty(s))throw Error("You cannot have multiple drop down's with order "+s);i[s]={$element:t,element:this,json:t.data("json"),text:t.data("option-text"),value:t.data("option-value")},i.elements.push(s),t.change(function(){if(!o)for(var t=i.findAllAfter(s),a=0;a<t.length;a++){var f=t[a];i[f].$element.empty()}for(var u={},a=0;a<i.elements.length;a++){var v=i.elements[a],c=i[v].element;c.selectedIndex>-1&&(u[c.name]=c.options[c.selectedIndex].value)}e.ajax(r.service,{data:u,dataType:"json",method:r.method}).done(function(e){var t=i.findFirstAfter(s),r=i[t];if(!r)return void(null!=d&&d.reject());if(!e.hasOwnProperty(r.json))throw Error(r.json+" is not found in service response");o&&r.$element.empty();var a=r.element,f=e[r.json],u=n("","");a.options.add(u);for(var v=0;v<f.length;v++){var c=n(f[v][r.text],f[v][r.value]);a.options.add(c)}l.trigger("loaded",[a]),null!==d&&d.resolve(r)})})}),r.loadAll&&a.length>0){var s=0,f=function(e,t){if(t<a.length){var n=a[t];e.$element.val(n).change()}},u=function(){d=e.Deferred(),d.done(function(e){u(),s++,f(e,s)}).fail(function(){l.prop("disabled",!1),o=!1,l.trigger("ready")})};u();var v=i[i.root];v&&f(v,s)}return this}}(jQuery);